---
title: "STAT 447 Assignment 4"
author: "Caden Hewlett"
date: "`r Sys.Date()`"
header-includes:
   - \usepackage{bbm}
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(extraDistr)
library(ggplot2)
library(pracma)
library(distr)
library(latex2exp)
source("scaffold.R")
source("simple.R")
source("simple_utils.R")
```


# Question 1 : Logistic Rocket Improvement

Recall the Rocket data from last week:
```{r rocketdat}
launches = c(1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1)
```

Recall that we discussed a model where the reliability of the rocket changes in time. This will allow us to incorporate, for example, the fact that engineering teams implement fixes based on past launches and therefore the probability of success should increase.

## Part 1

Write a function called `logistic_regression` containing a `simPPLe` probabilistic programming description of the model described in class. 

We recall that the model was of the following form, where $\ell$ is the launch and $\ell \in \{1, 2, \dots 11\}$.

For algebraic conciseness, we let $\text{slope} = \beta_1$ and $\text{intercept} = \beta_0$.

Therefore, by the reasoning dicsussed in class,


\begin{align*}
\beta_1 &\sim {N}(0, 1) \\
\beta_0 &\sim {N}(0, 1) \\
\theta(\ell) &= \text{logistic}(\beta_1 \cdot \ell + \beta_0) = \big(1 + \exp(-(\beta_1 \cdot \ell + \beta_0)\big)^{-1}\\
\end{align*}

Let's begin to design our function.

```{r logisticreg}
logistic_regression = function() {
  beta_1 = simulate(distr::Norm(0, 1))
  beta_0 = simulate(distr::Norm(0, 1))
  sapply(1:length(launches),
         function(L) {
           observe(launches[L],
                   Bern(plogis(beta_0 + beta_1 * L)))
         })
  next_p = plogis(beta_0 + beta_1 * 12)
  return(c(beta_0, beta_1, simulate(Bern(next_p))))
}
```

Your function should return a vector containing 3 elements in the following order:

The intercept, $\beta_0 \in \mathbb{R}$, the slope ($\beta_1 \in \mathbb{R}$), a prediction if one more launch would have been successful (1) or a failure (0) ($s \in \{0,1\}$).

```{r evidence}
logistic_regression()
```


## Part 2


Follow the instructions in the appendix below to get some helper functions. Use these functions to reproduce the lectureâ€™s bivariate posterior plot over the intercept and slope parameters.


The code to produce the bivariate posterior plot is below:

```{r bivariatepost}
set.seed(11292023)
post = posterior_particles(logistic_regression, 1000)
weighted_scatter_plot(post,
                      plot_options =
                        list(
    xlab = TeX(r'($\hat{\beta}_0, Intercept \; Terms$)'),
    ylab = TeX(r'($\hat{\beta}_1, Slope \; Terms$)'),
    main = TeX(r'(Weighted Forward Simulated Values for m\in\{1, 2, ..., M\})')
                        ))
```


## Part 3


Estimate the probability that the next launch is a success given the data under the **logistic model**.

We know that the launches so far can be thought of as realizations of the random vector $\vec{Y} = Y_{1:11 } = \{Y_1, Y_2, Y_3, \dots, Y_{11} \}$. From these, we have the specific realizations (i.e. "our data")  $\vec{y} = \{1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1 \}$. 


Note that there are $n = 11$ launches so far.


We wish to find:

$$
P(Y_{12} = 1 \mid Y_1 = 1, Y_2 = 0, Y_3 = 1, \dots Y_{11} = 1)
$$
Or, in a simpler sense, using the variables defined earlier, 

$$
P(Y_{12} = 1 \mid Y_{1:12} = \vec{y}\,)
$$
In order to find this probability, all we need to do is add this outcome of $Y_{12}$ and use our forward simulator. 

We do this as follows:

```{r whatdaheck}
launches = c(launches, 1)
next_launch_post = posterior(logistic_regression, 1000)
rbind(c("beta_0", "beta_1", "success"), next_launch_post)
```


## Part 4

Create a variant of the same model but where the **slope is set to zero**. Estimate the probability that the next launch is a success given the data under this simplified model.



# Question 2 : Choosing a Model

You debate with your friend whether the logistic model or the simplified model (with slope equals to zero) should be preferred. To stop that debate, write a **unified** model which gives probability 1/2 to the simplified model, and 1/2 to the logistic model. 


Estimate the posterior probability that the logistic model is preferred under the unified model given the same data as in Q.1.

Where $\psi \in \{0, 1\}$ is whether we choose no slope ($\psi = 0$) or to include slope ($\psi = 1$.) We begin by assuming each outcome is equally likely. 

\begin{align*}
\beta_1 &\sim {N}(0, 1) \\
\beta_0 &\sim {N}(0, 1) \\
\psi &\sim \text{bern}(1/2)\\
\theta(\ell)  = \big(1 + \exp(-\big(\beta_1 \cdot \psi \cdot\ell \big)+ \beta_0)\big)^{-1}
\end{align*}

<!-- Understanding $\psi_{\text{post}}$ is posterior Bernoulli probability density function, while its parameter, $p_{\text{prior}} = 1/2$ to $p_{\text{prior}} = \text{?}$, is what we'd like to observe for this decision making process. In other words, the parameter of the posterior Bernoulli distribution. -->
trivariate posterior I think