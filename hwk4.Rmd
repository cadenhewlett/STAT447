---
title: "STAT 447 Assignment 4"
author: "Caden Hewlett"
date: "`r Sys.Date()`"
header-includes:
   - \usepackage{bbm}
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(extraDistr)
library(ggplot2)
library(pracma)
library(distr)
```


# Question 1 : Logistic Rocket Improvement

Recall the Rocket data from last week:
```{r rocketdat}
success_indicators = c(1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1)
launches = success_indicators
```

Recall that we discussed a model where the reliability of the rocket changes in time. This will allow us to incorporate, for example, the fact that engineering teams implement fixes based on past launches and therefore the probability of success should increase.

## Part 1

Write a function called `logistic_regression` containing a `simPPLe` probabilistic programming description of the model described in class. 

```{r log_reg}
source("scaffold.R")
source("simple.R")
```

We recall that the model was of the following form, where $\ell$ is the launch and $\ell \in \{1, 2, \dots 11\}$.

For algebraic conciseness, we let $\text{slope} = \beta_1$ and $\text{intercept} = \beta_0$.

Therefore, by the reasoning dicsussed in class,


\begin{align*}
\beta_1 &\sim {N}(0, 1) \\
\beta_0 &\sim {N}(0, 1) \\
\theta(\ell) &= \text{logistic}(\beta_1 \cdot \ell + \beta_0) = \big(1 + \exp(-(\beta_1 \cdot \ell + \beta_0)\big)^{-1}\\
\end{align*}

Let's begin to design our function.

```{r logisticreg}

logistic_regression <- function(){
  beta_1 = simulate(Norm(0, 1))
  beta_0 = simulate(Norm(0, 1))
  sapply(1:length(launches),
         function(L){
           observe(launches[L], 
                   beta_0 + beta_1*L)
         })
}

```

Your function should return a vector containing 3 elements in the following order:

The intercept, $\beta_0 \in \mathbb{R}$, the slope ($\beta_1 \in \mathbb{R}$), a prediction if one more launch would have been successful (1) or a failure (0) ($s \in \{0,1\}$).


## Part 2


Follow the instructions in the appendix below to get some helper functions. Use these functions to reproduce the lectureâ€™s bivariate posterior plot over the intercept and slope parameters.


## Part 3


Estimate the probability that the next launch is a success given the data under the **logistic model**.


## Part 4

Create a variant of the same model but where the **slope is set to zero**. Estimate the probability that the next launch is a success given the data under this simplified model.



# Question 2 : Choosing a Model

You debate with your friend whether the logistic model or the simplified model (with slope equals to zero) should be preferred. To stop that debate, write a **unified** model which gives probability 1/2 to the simplified model, and 1/2 to the logistic model. 


Estimate the posterior probability that the logistic model is preferred under the unified model given the same data as in Q.1.